<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-maps-api-key" content="AIzaSyCGuiWVQgNS8egFImIxqQjA1LFI47TBmw8" />
    <title>ì—¬í–‰ ì¼ì • ìš”ì•½ - Via Flight</title>
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="stylesheet" href="styles/pages/trip-summary.css" />
    <link rel="stylesheet" href="styles/components/buttons.css" />
    <link rel="stylesheet" href="styles/components/cards.css" />
    <link rel="stylesheet" href="styles/components/forms.css" />
  </head>
  <body class="app trip-summary-page">
    <header class="app-header">
      <h1>Via Flight</h1>
      <p class="tagline">ì—¬í–‰ ì¼ì • ìš”ì•½</p>
      <nav class="breadcrumb">
        <a href="landing.html" class="breadcrumb__link">â† í™ˆìœ¼ë¡œ</a>
      </nav>
    </header>

    <main class="trip-summary-main">
      <!-- Transfer Summary -->
      <section class="transfer-summary">
        <div class="summary-card">
          <h2 class="summary-title">ì—¬í–‰ ì •ë³´</h2>
          <div class="summary-content">
            <div class="summary-item">
              <span class="summary-label">ê²½ìœ  ë„ì‹œ</span>
              <span class="summary-value" id="summary-city">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">í™˜ìŠ¹ ì‹œê°„</span>
              <span class="summary-value" id="summary-duration">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">ë„ì°© ì‹œê°„</span>
              <span class="summary-value" id="summary-arrival">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">ì¶œë°œ ì‹œê°„</span>
              <span class="summary-value" id="summary-departure">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">ì—¬í–‰ ìŠ¤íƒ€ì¼</span>
              <span class="summary-value" id="summary-style">-</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Schedule Overview -->
      <section class="schedule-overview">
        <div class="overview-container">
          <h2 class="overview-title">ì „ì²´ ì¼ì •</h2>
          <p class="overview-description">
            ì„ íƒí•˜ì‹  ì¥ì†Œë“¤ë¡œ êµ¬ì„±ëœ ìµœì ì˜ ì—¬í–‰ ì¼ì •ì…ë‹ˆë‹¤.
          </p>

          <div class="schedule-sections" id="schedule-sections">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
          </div>

          <div class="schedule-stats">
            <div class="stat-card">
              <div class="stat-icon">ğŸ“</div>
              <div class="stat-content">
                <div class="stat-number" id="total-locations">0</div>
                <div class="stat-label">ë°©ë¬¸ ì¥ì†Œ</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">â±ï¸</div>
              <div class="stat-content">
                <div class="stat-number" id="total-time">0ë¶„</div>
                <div class="stat-label">ì´ ì†Œìš”ì‹œê°„</div>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-icon">ğŸš¶</div>
              <div class="stat-content">
                <div class="stat-number" id="walking-time">0ë¶„</div>
                <div class="stat-label">ì´ë™ì‹œê°„</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Tips and Recommendations -->
      <section class="tips-section">
        <div class="tips-container">
          <h2 class="tips-title">ğŸ’¡ ì—¬í–‰ íŒ</h2>
          <div class="tips-grid" id="tips-grid">
            <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
          </div>
        </div>
      </section>

      <!-- Action Buttons -->
      <section class="action-section">
        <div class="action-container">
          <div class="completion-message">
            <h2>ğŸ‰ í™˜ìŠ¹ ì—¬í–‰ì„ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤!</h2>
            <p>ì†Œì¤‘í•œ ì—¬í–‰ì˜ ê¸°ë¡ì„ ê³µìœ í•˜ê³  ì €ì¥í•´ë³´ì„¸ìš”.</p>
          </div>
          
          <div class="share-section">
            <h3>ì¼ì • ê³µìœ í•˜ê¸°</h3>
            <div class="share-buttons">
              <button class="btn btn--small btn--ghost" onclick="shareSchedule('link')">
                ë§í¬ ê³µìœ 
              </button>
              <button class="btn btn--small btn--ghost" onclick="shareSchedule('image')">
                ì´ë¯¸ì§€ ì €ì¥
              </button>
              <button class="btn btn--small btn--secondary" onclick="shareSchedule('text')">
                í…ìŠ¤íŠ¸ ë³µì‚¬
              </button>
            </div>
          </div>
          
          <div class="action-buttons">
            <button class="btn btn--primary" onclick="goToHome()">
              ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
            </button>
          </div>
        </div>
      </section>
    </main>

    <script type="module" src="scripts/router.js"></script>
    <script>
      // ì „ì—­ ìƒíƒœ
      let scheduleData = null;
      let transferInfo = null;

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener('DOMContentLoaded', function() {
        try {
          loadScheduleData();
          
          if (!scheduleData) {
            console.warn('âš ï¸ scheduleDataê°€ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ë°ì´í„°ë¡œ ì§„í–‰');
            setDefaultData();
          }
          
          if (transferInfo) {
            try {
              updateSummary();
            } catch (error) {
              console.error('updateSummary ì˜¤ë¥˜:', error);
            }
          }
          
          try {
            generateScheduleOverview();
          } catch (error) {
            console.error('generateScheduleOverview ì˜¤ë¥˜:', error);
          }
          
          try {
            updateStats();
          } catch (error) {
            console.error('updateStats ì˜¤ë¥˜:', error);
          }
          
          try {
            generateTips();
          } catch (error) {
            console.error('generateTips ì˜¤ë¥˜:', error);
          }
          
          console.log('âœ… trip-summary ì´ˆê¸°í™” ì™„ë£Œ');
        } catch (error) {
          console.error('âŒ trip-summary ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
          alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }
      });

       // ì¼ì • ë°ì´í„° ë¡œë“œ
       function loadScheduleData() {
         console.log('ğŸš€ trip-summary.html ì´ˆê¸°í™” ì‹œì‘');
         
         // sessionStorageì—ì„œ ìµœì¢… ì¼ì • ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
         const finalTripPlanStr = sessionStorage.getItem('finalTripPlan');
         console.log('ğŸ“¦ sessionStorageì—ì„œ finalTripPlan ê°€ì ¸ì˜´:', finalTripPlanStr ? 'ìˆìŒ' : 'ì—†ìŒ');
         
         if (finalTripPlanStr) {
           try {
             const finalTripPlan = JSON.parse(finalTripPlanStr);
             const plannerResult = finalTripPlan.plannerResult;
             console.log('ğŸ“‹ plannerResult:', plannerResult);
             console.log('ğŸ“¦ finalTripPlan ì „ì²´:', finalTripPlan);
             
            if (plannerResult) {
              // airport-external íƒ€ì…ì¸ ê²½ìš° ê³µí•­ ë‚´ë¶€ POI ë°ì´í„°ë¥¼ sessionStorageì—ì„œ ê°€ì ¸ì˜´
              const airportPOIDataStr = sessionStorage.getItem('airportPOIData');
              let airportPOIs = [];
              let cityPOIs = [];
              
              if (airportPOIDataStr) {
                try {
                  const airportPOIData = JSON.parse(airportPOIDataStr);
                  
                  // ì„ íƒëœ POI ID ëª©ë¡ê³¼ ì „ì²´ POI ëª©ë¡ì„ ë§¤ì¹­í•˜ì—¬ airportPOIs ìƒì„±
                  airportPOIs = airportPOIData.selectedPOIs
                    .map(poiId => airportPOIData.allPOIs.find(p => p.id === poiId))
                    .filter(poi => poi != null)
                    .map(poi => ({
                      id: poi.id,
                      name: poi.name,
                      address: poi.location || '',
                      description: poi.description || '',
                      rating: poi.rating || 4.0,
                      userRatingsTotal: poi.userRatingsTotal || 0,
                      categoryIcon: poi.categoryIcon || 'ğŸ“',
                      imageUrl: poi.imageUrl || '',
                      estimatedTime: poi.estimatedTime || 10,
                      category: poi.category || 'ê¸°íƒ€'
                    }));
                  
                } catch (error) {
                  console.error('âŒ airportPOIData íŒŒì‹± ì‹¤íŒ¨:', error);
                }
              }
              
              // waypointsëŠ” city POIë¡œ ê°„ì£¼
              const allWaypoints = plannerResult.waypoints || [];
              cityPOIs = allWaypoints.map((wp, index) => ({
                id: `city_${index}`,
                name: wp.label || 'Unknown',
                address: wp.address || '',
                description: wp.description || '',
                rating: wp.rating || 0,
                userRatingsTotal: wp.userRatingsTotal || 0,
                categoryIcon: wp.categoryIcon || 'ğŸ“',
                imageUrl: wp.photos?.[0] || '',
                estimatedTime: wp.stayMinutes || 10,
                category: wp.categoryKey || 'ê¸°íƒ€'
              }));
              
              scheduleData = {
                transferInfo: {
                  city: plannerResult.meta?.cityText || 'ì‹±ê°€í¬ë¥´',
                  arrival: plannerResult.meta?.arrival,
                  departure: plannerResult.meta?.departure,
                  duration: plannerResult.meta?.exploreWindow?.availableMinutes * 60000
                },
                type: 'airport-external',
                waypoints: allWaypoints,
                airportPOIs: airportPOIs,
                cityPOIs: cityPOIs,
                actualTimeline: finalTripPlan.actualTimeline, // ì‹¤ì œ ê³„ì‚°ëœ ì‹œê°„í‘œ ì¶”ê°€
                completedAt: finalTripPlan.completedAt
              };
              
              if (finalTripPlan.actualTimeline) {
                console.log('âœ… ì‹¤ì œ ê³„ì‚°ëœ íƒ€ì„ë¼ì¸ ë¡œë“œ ì™„ë£Œ:', finalTripPlan.actualTimeline.length, 'ê°œ ì„¸ê·¸ë¨¼íŠ¸');
                console.log('ğŸ“‹ actualTimeline ë‚´ìš©:', finalTripPlan.actualTimeline);
              } else {
                console.log('âš ï¸ actualTimeline ë°ì´í„° ì—†ìŒ');
              }
              transferInfo = scheduleData.transferInfo;
            } else {
              setDefaultData();
            }
           } catch (error) {
             console.error('âŒ ìµœì¢… ì¼ì • ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
             setDefaultData();
           }
         } else {
           setDefaultData();
         }
       }

      function setDefaultData() {
        // ê¸°ë³¸ê°’ ì„¤ì • (í…ŒìŠ¤íŠ¸ìš©)
        scheduleData = {
          transferInfo: {
            city: 'ì‹±ê°€í¬ë¥´',
            arrival: new Date(),
            departure: new Date(Date.now() + 4 * 60 * 60 * 1000),
            duration: 4 * 60 * 60 * 1000
          },
          type: 'airport-external',
          waypoints: [],
          completedAt: new Date().toISOString()
        };
        transferInfo = scheduleData.transferInfo;
      }

      // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
      function updateSummary() {
        if (!transferInfo) {
          // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€ í‘œì‹œ
          document.getElementById('summary-city').textContent = 'ë°ì´í„° ì—†ìŒ';
          document.getElementById('summary-duration').textContent = '-';
          document.getElementById('summary-arrival').textContent = '-';
          document.getElementById('summary-departure').textContent = '-';
          document.getElementById('summary-style').textContent = '-';
          return;
        }

        document.getElementById('summary-city').textContent = transferInfo.city || 'ì‹±ê°€í¬ë¥´';
        document.getElementById('summary-duration').textContent = formatDuration(transferInfo.duration || 0);
        document.getElementById('summary-arrival').textContent = formatDateTime(transferInfo.arrival);
        document.getElementById('summary-departure').textContent = formatDateTime(transferInfo.departure);
        
        const styleText = scheduleData.type === 'airport-only' ? 'ê³µí•­ ë‚´ë¶€ë§Œ' : 'ê³µí•­ + ë„ì‹œ';
        document.getElementById('summary-style').textContent = styleText;
      }

      // ì‹œê°„ í¬ë§·íŒ…
      function formatDuration(durationMs) {
        const hours = Math.floor(durationMs / (1000 * 60 * 60));
        const minutes = Math.floor((durationMs % (1000 * 60 * 60)) / (1000 * 60));
        
        let result = '';
        if (hours > 0) result += `${hours}ì‹œê°„`;
        if (minutes > 0) result += ` ${minutes}ë¶„`;
        
        return result || '0ë¶„';
      }

      // ë‚ ì§œ ì‹œê°„ í¬ë§·íŒ…
      function formatDateTime(date) {
        if (!date) return '-';
        
        const d = new Date(date);
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        const hours = String(d.getHours()).padStart(2, '0');
        const minutes = String(d.getMinutes()).padStart(2, '0');
        
        return `${year}.${month}.${day} ${hours}:${minutes}`;
      }

      // ì¼ì • ê°œìš” ìƒì„±
      function generateScheduleOverview() {
        if (!scheduleData) {
          console.warn('generateScheduleOverview: scheduleDataê°€ ì—†ìŠµë‹ˆë‹¤');
          const container = document.getElementById('schedule-sections');
          if (container) {
            container.innerHTML = '<p class="empty-message">ì¼ì • ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
          }
          return;
        }
        
        const container = document.getElementById('schedule-sections');
        if (!container) {
          console.error('schedule-sections ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
          return;
        }
        
        container.innerHTML = '';

        if (scheduleData.type === 'airport-only') {
          generateAirportOnlySchedule(container);
        } else if (scheduleData.type === 'airport-external') {
          generateAirportExternalSchedule(container);
        }
      }

      // ê³µí•­ ë‚´ë¶€ë§Œ ì¼ì • ìƒì„±
      function generateAirportOnlySchedule(container) {
        const section = document.createElement('div');
        section.className = 'schedule-section airport-section';
        
        section.innerHTML = `
          <h3>ğŸ¢ ê³µí•­ ë‚´ë¶€ ì¼ì •</h3>
          <div class="timeline" id="airport-timeline">
            ${generateTimelineItems(scheduleData.airportPOIs || [], 'airport')}
          </div>
        `;
        
        container.appendChild(section);
      }

      // ê³µí•­ + ë„ì‹œ ì¼ì • ìƒì„±
      function generateAirportExternalSchedule(container) {
        // ê³µí•­ ë‚´ë¶€ ì„¹ì…˜
        const airportSection = document.createElement('div');
        airportSection.className = 'schedule-section airport-section';
        
        airportSection.innerHTML = `
          <h3>ğŸ¢ ê³µí•­ ë‚´ë¶€ ì¼ì •</h3>
          <div class="timeline" id="airport-timeline">
            ${generateTimelineItems(scheduleData.airportPOIs || [], 'airport')}
          </div>
        `;
        
        container.appendChild(airportSection);

        // ë„ì‹œ ì„¹ì…˜
        const citySection = document.createElement('div');
        citySection.className = 'schedule-section city-section';
        
        citySection.innerHTML = `
          <h3>ğŸ™ï¸ ë„ì‹œ íƒë°© ì¼ì •</h3>
          <div class="timeline" id="city-timeline">
            ${generateTimelineItems(scheduleData.cityPOIs || [], 'city')}
          </div>
        `;
        
        container.appendChild(citySection);
      }

      // ì‹¤ì œ ê³„ì‚°ëœ íƒ€ì„ë¼ì¸ ìƒì„± (navigation.htmlì—ì„œ ê³„ì‚°ëœ ì‹¤ì œ ì‹œê°„í‘œ ì‚¬ìš©)
      function generateActualTimeline(pois, actualTimeline) {
        if (!actualTimeline || actualTimeline.length === 0) {
          return '<p class="empty-timeline">ì‹¤ì œ ê³„ì‚°ëœ ì¼ì • ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        const arrivalTime = new Date(transferInfo.arrival);
        let currentTime = new Date(arrivalTime);
        
        // ê³µí•­ ë‚´ë¶€ ì¼ì • í›„ ë„ì‹œ ì¼ì • ì‹œì‘
        currentTime.setHours(currentTime.getHours() + 2);

        return actualTimeline.map((segment, index) => {
          const poi = pois[index];
          const poiName = poi?.name || segment.toLabel || 'Unknown';
          const poiCategory = poi?.category || 'ê¸°íƒ€';
          
          // ì´ë™ ì‹œê°„ ê³„ì‚° (ì„¸ê·¸ë¨¼íŠ¸ì˜ durationì„ ë¶„ìœ¼ë¡œ ë³€í™˜)
          const travelTime = Math.round(segment.duration / 60); // ì´ˆ -> ë¶„
          
          // ì´ë™ ì¤‘ ì•„ì´í…œ
          const travelStartTime = new Date(currentTime);
          const travelEndTime = new Date(currentTime.getTime() + travelTime * 60000);
          const travelTimeItem = `
            <div class="timeline-item timeline-item--travel">
              <div class="timeline-time">
                <span class="start-time">${formatTime(travelStartTime)}</span>
                <span class="end-time">${formatTime(travelEndTime)}</span>
              </div>
              <div class="timeline-content">
                <h4>ğŸš¶ ì´ë™ ì¤‘</h4>
                <p>${travelTime}ë¶„ ì´ë™ (${segment.distanceText || ''})</p>
                <p class="details">${segment.fromLabel} â†’ ${segment.toLabel}</p>
              </div>
            </div>
          `;
          
          currentTime = travelEndTime;
          
          // ì²´ë¥˜ ì‹œê°„ ê³„ì‚° (POIì˜ estimatedTime ë˜ëŠ” ê¸°ë³¸ê°’ ì‚¬ìš©)
          const stayTime = poi?.estimatedTime || poi?.stayMinutes || 60;
          const stayStartTime = new Date(currentTime);
          const stayEndTime = new Date(currentTime.getTime() + stayTime * 60000);
          
          const timelineItem = `
            <div class="timeline-item">
              <div class="timeline-time">
                <span class="start-time">${formatTime(stayStartTime)}</span>
                <span class="end-time">${formatTime(stayEndTime)}</span>
              </div>
              <div class="timeline-content">
                <h4>${poiName}</h4>
                <span class="timeline-category">${poiCategory}</span>
                <p>${stayTime}ë¶„ ì²´ë¥˜</p>
                ${poi?.address ? `<p class="address">${poi.address}</p>` : ''}
              </div>
            </div>
          `;
          
          currentTime = stayEndTime;
          return travelTimeItem + timelineItem;
        }).join('');
      }

      // íƒ€ì„ë¼ì¸ ì•„ì´í…œ ìƒì„±
      function generateTimelineItems(pois, type) {
        if (!pois || pois.length === 0) {
          return '<p class="empty-timeline">ì„ íƒëœ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        // ì‹¤ì œ ê³„ì‚°ëœ íƒ€ì„ë¼ì¸ì´ ìˆìœ¼ë©´ ì‚¬ìš©
        if (scheduleData.actualTimeline && type === 'city') {
          console.log('ğŸ“… ì‹¤ì œ ê³„ì‚°ëœ íƒ€ì„ë¼ì¸ìœ¼ë¡œ ìƒì„± ì‹œì‘');
          return generateActualTimeline(pois, scheduleData.actualTimeline);
        } else {
          console.log('âš ï¸ ì‹¤ì œ íƒ€ì„ë¼ì¸ ì—†ìŒ, ì¶”ì •ê°’ ì‚¬ìš©');
        }

        const arrivalTime = new Date(transferInfo.arrival);
        let currentTime = new Date(arrivalTime);
        
        // ë„ì‹œ ì¼ì •ì˜ ê²½ìš° ê³µí•­ ë‚´ë¶€ ì¼ì • í›„ ì‹œì‘
        if (type === 'city') {
          currentTime.setHours(currentTime.getHours() + 2);
        }

        return pois.map((poi, index) => {
          // POIê°€ IDì¸ì§€ ê°ì²´ì¸ì§€ í™•ì¸
          const poiData = typeof poi === 'object' ? poi : { id: poi, name: 'Unknown', estimatedTime: 10 };
          
          const poiName = poiData.name || 'Unknown';
          const poiCategory = poiData.category || 'ê¸°íƒ€';
          const estimatedTime = poiData.estimatedTime || poiData.stayMinutes || 10;
          const travelTime = poiData.travelTime || 0; // ì´ì „ ê²½ìœ ì§€ì—ì„œ ì´ë™ ì‹œê°„

          // ì²« ë²ˆì§¸ ê²½ìœ ì§€ê°€ ì•„ë‹ˆê³  ì´ë™ ì‹œê°„ì´ ìˆëŠ” ê²½ìš° ì´ë™ ì‹œê°„ í‘œì‹œ
          let travelTimeItem = '';
          if (index > 0 && travelTime > 0) {
            const travelStartTime = new Date(currentTime);
            const travelEndTime = new Date(currentTime.getTime() + travelTime * 60000);
            travelTimeItem = `
              <div class="timeline-item timeline-item--travel">
                <div class="timeline-time">
                  <span class="start-time">${formatTime(travelStartTime)}</span>
                  <span class="end-time">${formatTime(travelEndTime)}</span>
                </div>
                <div class="timeline-content">
                  <h4>ğŸš¶ ì´ë™ ì¤‘</h4>
                  <p>${travelTime}ë¶„ ì´ë™</p>
                </div>
              </div>
            `;
            currentTime = travelEndTime;
          }

          const startTime = new Date(currentTime);
          const endTime = new Date(currentTime.getTime() + estimatedTime * 60000);
          
          const timelineItem = `
            ${travelTimeItem}
            <div class="timeline-item">
              <div class="timeline-time">
                <span class="start-time">${formatTime(startTime)}</span>
                <span class="end-time">${formatTime(endTime)}</span>
              </div>
              <div class="timeline-content">
                <h4>${poiName}</h4>
                <span class="timeline-category">${poiCategory}</span>
                <p>${estimatedTime}ë¶„ ì²´ë¥˜</p>
                ${poiData.address ? `<p class="address">${poiData.address}</p>` : ''}
              </div>
            </div>
          `;
          
          currentTime = endTime;
          return timelineItem;
        }).join('');
      }

      // ì‹œê°„ í¬ë§·íŒ… (HH:MM)
      function formatTime(date) {
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${hours}:${minutes}`;
      }

      // í†µê³„ ì—…ë°ì´íŠ¸
      function updateStats() {
        if (!scheduleData) {
          console.warn('updateStats: scheduleDataê°€ ì—†ìŠµë‹ˆë‹¤');
          return;
        }
        
        const airportCount = scheduleData.airportPOIs ? scheduleData.airportPOIs.length : 0;
        const cityCount = scheduleData.cityPOIs ? scheduleData.cityPOIs.length : 0;
        const totalLocations = airportCount + cityCount;
        
        const totalLocationsEl = document.getElementById('total-locations');
        if (totalLocationsEl) {
          totalLocationsEl.textContent = totalLocations;
        }

        // ì´ ì†Œìš”ì‹œê°„ ê³„ì‚° (ì„ì‹œ)
        const totalTime = totalLocations * 60; // í‰ê·  60ë¶„ì”©
        const totalTimeEl = document.getElementById('total-time');
        if (totalTimeEl) {
          totalTimeEl.textContent = `${totalTime}ë¶„`;
        }

        // ì´ë™ì‹œê°„ ê³„ì‚° (ì„ì‹œ)
        const walkingTime = Math.max(0, totalLocations - 1) * 15; // ì¥ì†Œ ê°„ ì´ë™ 15ë¶„ì”©
        const walkingTimeEl = document.getElementById('walking-time');
        if (walkingTimeEl) {
          walkingTimeEl.textContent = `${walkingTime}ë¶„`;
        }
      }

      // íŒ ìƒì„±
      function generateTips() {
        const container = document.getElementById('tips-grid');
        if (!container) {
          console.error('tips-grid ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
          return;
        }
        
        if (!scheduleData) {
          console.warn('generateTips: scheduleDataê°€ ì—†ìŠµë‹ˆë‹¤');
          container.innerHTML = '';
          return;
        }
        
        const tips = getTipsForSchedule(scheduleData);
        
        container.innerHTML = tips.map(tip => `
          <div class="tip-card">
            <div class="tip-icon">${tip.icon}</div>
            <h4>${tip.title}</h4>
            <p>${tip.description}</p>
          </div>
        `).join('');
      }

      // ì¼ì •ì— ë”°ë¥¸ íŒ ê°€ì ¸ì˜¤ê¸°
      function getTipsForSchedule(schedule) {
        if (!schedule) {
          console.warn('getTipsForSchedule: scheduleì´ nullì…ë‹ˆë‹¤');
          return [];
        }
        
        const baseTips = [
          {
            icon: 'ğŸ’',
            title: 'ì§ ë³´ê´€ì†Œ',
            description: 'ê³µí•­ ë‚´ ì§ ë³´ê´€ì†Œë¥¼ ì´ìš©í•˜ë©´ ê°€ë²¼ìš´ ì‡¼í•‘ê³¼ ê´€ê´‘ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.'
          },
          {
            icon: 'ğŸ“¶',
            title: 'ë¬´ë£Œ ì™€ì´íŒŒì´',
            description: 'ê³µí•­ ë‚´ ë¬´ë£Œ ì™€ì´íŒŒì´ë¥¼ ì—°ê²°í•˜ì—¬ ì‹¤ì‹œê°„ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.'
          },
          {
            icon: 'â°',
            title: 'ì‹œê°„ ê´€ë¦¬',
            description: 'ì¶œë°œ ì‹œê°„ì„ ê³ ë ¤í•˜ì—¬ ì¶©ë¶„í•œ ì—¬ìœ  ì‹œê°„ì„ í™•ë³´í•˜ì„¸ìš”.'
          }
        ];

        if (schedule.type === 'airport-external') {
          baseTips.push(
            {
              icon: 'ğŸš‡',
              title: 'êµí†µí¸',
              description: 'ê³µí•­ì—ì„œ ë„ì‹œê¹Œì§€ì˜ êµí†µí¸ì„ ë¯¸ë¦¬ í™•ì¸í•˜ê³  ì‹œê°„ì„ ê³ ë ¤í•˜ì„¸ìš”.'
            },
            {
              icon: 'ğŸ—ºï¸',
              title: 'ì§€ë„ ì•±',
              description: 'ì˜¤í”„ë¼ì¸ ì§€ë„ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì¸í„°ë„· ì—†ì´ë„ ê¸¸ì„ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
            }
          );
        }

        return baseTips;
      }

      // ì¼ì • ìˆ˜ì •í•˜ê¸°
      // í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
      function goToHome() {
        window.location.href = 'landing.html';
      }

      // ì¼ì • ê³µìœ í•˜ê¸°
      function shareSchedule(type) {
        if (type === 'link') {
          // ë§í¬ ê³µìœ  ë¡œì§
          const shareUrl = window.location.origin + window.location.pathname;
          navigator.clipboard.writeText(shareUrl).then(() => {
            alert('ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
          });
        } else if (type === 'image') {
          // ì´ë¯¸ì§€ ì €ì¥ ë¡œì§
          alert('ì´ë¯¸ì§€ ì €ì¥ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        }
      }
    </script>
  </body>
</html>
