<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-maps-api-key" content="AIzaSyCGuiWVQgNS8egFImIxqQjA1LFI47TBmw8" />
    <title>ê³µí•­ ë°– ì—¬í–‰ ì¼ì • - Via Flight</title>
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="stylesheet" href="styles/pages/airport-external.css" />
    <link rel="stylesheet" href="styles/components/buttons.css" />
    <link rel="stylesheet" href="styles/components/cards.css" />
    <link rel="stylesheet" href="styles/components/forms.css" />
    <link rel="stylesheet" href="styles/components/steps.css" />
  </head>
  <body class="app airport-external-page">
    <header class="app-header">
      <h1>Via Flight</h1>
      <p class="tagline">ê³µí•­ ë°– ì—¬í–‰ ì¼ì • ë§Œë“¤ê¸°</p>
      <nav class="breadcrumb">
        <a href="airport-main.html" class="breadcrumb__link">â† ì—¬í–‰ ìŠ¤íƒ€ì¼ ë‹¤ì‹œ ì„ íƒ</a>
      </nav>
    </header>

    <main class="airport-external-main">
      <!-- Progress Indicator -->
      <div class="progress-container">
        <div class="progress-steps">
          <div class="step completed">
            <div class="step-number">âœ“</div>
            <div class="step-label">í™˜ìŠ¹ ì •ë³´</div>
          </div>
          <div class="step completed">
            <div class="step-number">âœ“</div>
            <div class="step-label">ì—¬í–‰ ìŠ¤íƒ€ì¼</div>
          </div>
          <div class="step active">
            <div class="step-number">3</div>
            <div class="step-label">ê³µí•­ ë‚´ë¶€</div>
          </div>
          <div class="step">
            <div class="step-number">4</div>
            <div class="step-label">ë„ì‹œ íƒë°©</div>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 75%"></div>
        </div>
      </div>

      <!-- Transfer Summary -->
      <section class="transfer-summary">
        <div class="summary-card">
          <h2 class="summary-title">ê³µí•­ ë°– ì—¬í–‰ ì¼ì •</h2>
          <div class="summary-content">
            <div class="summary-item">
              <span class="summary-label">ê²½ìœ  ë„ì‹œ</span>
              <span class="summary-value" id="summary-city">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">í™˜ìŠ¹ ì‹œê°„</span>
              <span class="summary-value" id="summary-duration">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">ì—¬í–‰ ìŠ¤íƒ€ì¼</span>
              <span class="summary-value">ê³µí•­ + ë„ì‹œ</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Step 3.1: Airport Preferences -->
      <section class="preferences-step" id="preferences-step">
        <div class="step-container">
          <h2 class="step-title">ê³µí•­ ë‚´ë¶€ì—ì„œ ì–´ë–¤ ê²ƒì„ ì¢‹ì•„í•˜ì‹œë‚˜ìš”?</h2>
          <p class="step-description">
            ê³µí•­ ë‚´ë¶€ì—ì„œ ê´€ì‹¬ ìˆëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.<br>
            ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì— ë§ëŠ” ì¥ì†Œë“¤ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.
          </p>

          <div class="preference-cards">
            <button class="preference-card" data-category="shopping" onclick="togglePreference('shopping')">
              <div class="preference-icon">ğŸ›ï¸</div>
              <h3>ì‡¼í•‘</h3>
              <p>ë©´ì„¸ì , ê¸°ë…í’ˆ, ë¸Œëœë“œìƒµ</p>
            </button>
            <button class="preference-card" data-category="food" onclick="togglePreference('food')">
              <div class="preference-icon">ğŸ½ï¸</div>
              <h3>ìŒì‹</h3>
              <p>ê³µí•­ ë§›ì§‘, ì¹´í˜, ë°”</p>
            </button>
            <button class="preference-card" data-category="culture" onclick="togglePreference('culture')">
              <div class="preference-icon">ğŸ¨</div>
              <h3>ë¬¸í™”ì²´í—˜</h3>
              <p>ë°•ë¬¼ê´€, ê°¤ëŸ¬ë¦¬, ì „ì‹œ</p>
            </button>
            <button class="preference-card" data-category="relax" onclick="togglePreference('relax')">
              <div class="preference-icon">ğŸ’†</div>
              <h3>íœ´ì‹</h3>
              <p>ìŠ¤íŒŒ, ë§ˆì‚¬ì§€, ë¼ìš´ì§€</p>
            </button>
            <button class="preference-card" data-category="entertainment" onclick="togglePreference('entertainment')">
              <div class="preference-icon">ğŸ®</div>
              <h3>ì—”í„°í…Œì¸ë¨¼íŠ¸</h3>
              <p>ê²Œì„, ì˜í™”, ë¼ì´ë¸Œ ê³µì—°</p>
            </button>
            <button class="preference-card" data-category="services" onclick="togglePreference('services')">
              <div class="preference-icon">ğŸª</div>
              <h3>í¸ì˜ì‹œì„¤</h3>
              <p>ì€í–‰, ì•½êµ­, ì§ë³´ê´€ì†Œ</p>
            </button>
          </div>

          <div class="step-actions">
            <button class="btn btn--primary" onclick="nextToAirportPOISelection()" id="preferences-next" disabled>
              ë‹¤ìŒ ë‹¨ê³„ë¡œ
            </button>
          </div>
        </div>
      </section>

      <!-- Step 3.2: Airport POI Selection -->
      <section class="poi-selection-step" id="airport-poi-step" style="display: none;">
        <div class="step-container">
          <h2 class="step-title">ê³µí•­ ë‚´ë¶€ ë°©ë¬¸í•  ì¥ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
          <p class="step-description">
            ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì˜ ì¶”ì²œ ì¥ì†Œë“¤ì„ í™•ì¸í•˜ê³ <br>
            ê³µí•­ ë‚´ë¶€ì—ì„œ ë°©ë¬¸í•˜ê³  ì‹¶ì€ ì¥ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
          </p>

          <div class="poi-selection-content">
            <div class="filters-section">
              <h3>ì¹´í…Œê³ ë¦¬ í•„í„°</h3>
              <div class="filter-buttons" id="airport-filter-buttons">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
              </div>
            </div>

            <div class="poi-grid" id="airport-poi-grid">
              <!-- POI ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>

            <div class="selected-pois">
              <h3>ì„ íƒí•œ ê³µí•­ ë‚´ë¶€ ì¥ì†Œ</h3>
              <div class="selected-list" id="airport-selected-list">
                <p class="empty-message">ì•„ì§ ì„ íƒí•œ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              </div>
            </div>
          </div>

          <div class="step-actions">
            <button class="btn btn--ghost" onclick="backToAirportPreferences()">
              ì´ì „
            </button>
            <button class="btn btn--primary" onclick="nextToCityPreferences()" id="airport-poi-next" disabled>
              ë„ì‹œ íƒë°©ìœ¼ë¡œ
            </button>
          </div>
        </div>
      </section>

      <!-- Step 3.3: City Preferences -->
      <section class="city-preferences-step" id="city-preferences-step" style="display: none;">
        <div class="step-container">
          <h2 class="step-title">ë„ì‹œì—ì„œ ì–´ë–¤ ê²ƒì„ ì¢‹ì•„í•˜ì‹œë‚˜ìš”?</h2>
          <p class="step-description">
            ë„ì‹œ íƒë°©ì—ì„œ ê´€ì‹¬ ìˆëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.<br>
            ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì— ë§ëŠ” ë„ì‹œ ë‚´ ì¥ì†Œë“¤ì„ ì¶”ì²œí•´ë“œë¦½ë‹ˆë‹¤.
          </p>

          <div class="preference-cards">
            <button class="preference-card" data-category="attractions" onclick="toggleCityPreference('attractions')">
              <div class="preference-icon">ğŸ›ï¸</div>
              <h3>ê´€ê´‘ëª…ì†Œ</h3>
              <p>ëœë“œë§ˆí¬, ìœ ì ì§€, ì „ë§ëŒ€</p>
            </button>
            <button class="preference-card" data-category="shopping" onclick="toggleCityPreference('shopping')">
              <div class="preference-icon">ğŸ›ï¸</div>
              <h3>ì‡¼í•‘</h3>
              <p>ìƒì ê°€, ì‹œì¥, ë°±í™”ì </p>
            </button>
            <button class="preference-card" data-category="food" onclick="toggleCityPreference('food')">
              <div class="preference-icon">ğŸ½ï¸</div>
              <h3>ìŒì‹</h3>
              <p>ë¡œì»¬ ë§›ì§‘, ì¹´í˜, ë°”</p>
            </button>
            <button class="preference-card" data-category="culture" onclick="toggleCityPreference('culture')">
              <div class="preference-icon">ğŸ¨</div>
              <h3>ë¬¸í™”ì²´í—˜</h3>
              <p>ë°•ë¬¼ê´€, ê°¤ëŸ¬ë¦¬, ê³µì—°</p>
            </button>
            <button class="preference-card" data-category="nature" onclick="toggleCityPreference('nature')">
              <div class="preference-icon">ğŸŒ³</div>
              <h3>ìì—°</h3>
              <p>ê³µì›, í•´ë³€, ì‚°ì±…ë¡œ</p>
            </button>
            <button class="preference-card" data-category="nightlife" onclick="toggleCityPreference('nightlife')">
              <div class="preference-icon">ğŸŒƒ</div>
              <h3>ì•¼ê²½/ì•¼ìƒí™œ</h3>
              <p>ì•¼ê²½ ëª…ì†Œ, í´ëŸ½, ë°”</p>
            </button>
          </div>

          <div class="step-actions">
            <button class="btn btn--ghost" onclick="backToAirportPOISelection()">
              ì´ì „
            </button>
            <button class="btn btn--primary" onclick="nextToCityPOISelection()" id="city-preferences-next" disabled>
              ë‹¤ìŒ ë‹¨ê³„ë¡œ
            </button>
          </div>
        </div>
      </section>

      <!-- Step 3.4: City POI Selection -->
      <section class="city-poi-selection-step" id="city-poi-step" style="display: none;">
        <div class="step-container">
          <h2 class="step-title">ë„ì‹œì—ì„œ ë°©ë¬¸í•  ì¥ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
          <p class="step-description">
            ì„ íƒí•œ ì¹´í…Œê³ ë¦¬ì˜ ì¶”ì²œ ì¥ì†Œë“¤ì„ í™•ì¸í•˜ê³ <br>
            ë„ì‹œì—ì„œ ë°©ë¬¸í•˜ê³  ì‹¶ì€ ì¥ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
          </p>

          <div class="poi-selection-content">
            <div class="filters-section">
              <h3>ì¹´í…Œê³ ë¦¬ í•„í„°</h3>
              <div class="filter-buttons" id="city-filter-buttons">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
              </div>
            </div>

            <div class="poi-grid" id="city-poi-grid">
              <!-- POI ì¹´ë“œë“¤ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
            </div>

            <div class="selected-pois">
              <h3>ì„ íƒí•œ ë„ì‹œ ì¥ì†Œ</h3>
              <div class="selected-list" id="city-selected-list">
                <p class="empty-message">ì•„ì§ ì„ íƒí•œ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              </div>
            </div>
          </div>

          <div class="step-actions">
            <button class="btn btn--ghost" onclick="backToCityPreferences()">
              ì´ì „
            </button>
            <button class="btn btn--primary" onclick="nextToSchedule()" id="city-poi-next" disabled>
              ì¼ì • ë§Œë“¤ê¸°
            </button>
          </div>
        </div>
      </section>

      <!-- Step 3.5: Schedule Summary -->
      <section class="schedule-step" id="schedule-step" style="display: none;">
        <div class="step-container">
          <h2 class="step-title">ê³µí•­ + ë„ì‹œ ì—¬í–‰ ì¼ì • ì™„ì„±!</h2>
          <p class="step-description">
            ê³µí•­ ë‚´ë¶€ì™€ ë„ì‹œ íƒë°©ì„ í¬í•¨í•œ ìµœì ì˜ ì¼ì •ì„ ë§Œë“¤ì–´ë“œë ¸ìŠµë‹ˆë‹¤.<br>
            ì¼ì •ì„ í™•ì¸í•˜ê³  ì—¬í–‰ì„ ì‹œì‘í•´ë³´ì„¸ìš”.
          </p>

          <div class="schedule-content">
            <div class="schedule-sections">
              <div class="schedule-section">
                <h3>ğŸ¢ ê³µí•­ ë‚´ë¶€ ì¼ì •</h3>
                <div class="timeline" id="airport-timeline">
                  <!-- ê³µí•­ ë‚´ë¶€ íƒ€ì„ë¼ì¸ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
              </div>
              
              <div class="schedule-section">
                <h3>ğŸ™ï¸ ë„ì‹œ íƒë°© ì¼ì •</h3>
                <div class="timeline" id="city-timeline">
                  <!-- ë„ì‹œ íƒ€ì„ë¼ì¸ì´ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
                </div>
              </div>
            </div>

            <div class="tips-section">
              <h3>ğŸ’¡ ì—¬í–‰ íŒ</h3>
              <div class="tips-grid">
                <div class="tip-card">
                  <div class="tip-icon">ğŸš‡</div>
                  <h4>êµí†µí¸</h4>
                  <p>ê³µí•­ì—ì„œ ë„ì‹œê¹Œì§€ì˜ êµí†µí¸ì„ ë¯¸ë¦¬ í™•ì¸í•˜ê³  ì‹œê°„ì„ ê³ ë ¤í•˜ì„¸ìš”.</p>
                </div>
                <div class="tip-card">
                  <div class="tip-icon">ğŸ’</div>
                  <h4>ì§ ë³´ê´€</h4>
                  <p>ê³µí•­ ë‚´ ì§ ë³´ê´€ì†Œë¥¼ ì´ìš©í•˜ë©´ ê°€ë²¼ìš´ ë„ì‹œ íƒë°©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
                </div>
                <div class="tip-card">
                  <div class="tip-icon">â°</div>
                  <h4>ì‹œê°„ ê´€ë¦¬</h4>
                  <p>ì¶œë°œ ì‹œê°„ì„ ê³ ë ¤í•˜ì—¬ ì¶©ë¶„í•œ ì—¬ìœ  ì‹œê°„ì„ í™•ë³´í•˜ì„¸ìš”.</p>
                </div>
              </div>
            </div>
          </div>

          <div class="step-actions">
            <button class="btn btn--ghost" onclick="backToCityPOISelection()">
              ì¥ì†Œ ë‹¤ì‹œ ì„ íƒ
            </button>
            <button class="btn btn--primary" onclick="startNavigation()">
              ì—¬í–‰ ì‹œì‘í•˜ê¸°
            </button>
          </div>
        </div>
      </section>
    </main>

    <script type="module" src="scripts/router.js"></script>
    <script>
      // ì „ì—­ ìƒíƒœ
      let transferInfo = null;
      let selectedAirportPreferences = [];
      let selectedAirportPOIs = [];
      let selectedCityPreferences = [];
      let selectedCityPOIs = [];
      let currentStep = 'preferences';

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener('DOMContentLoaded', function() {
        loadTransferInfo();
        updateSummary();
        initializeAirportPreferences();
      });

      // í™˜ìŠ¹ ì •ë³´ ë¡œë“œ
      function loadTransferInfo() {
        const state = window.getAppState();
        if (state.transferInfo) {
          transferInfo = state.transferInfo;
        }
      }

      // ìš”ì•½ ì •ë³´ ì—…ë°ì´íŠ¸
      function updateSummary() {
        if (!transferInfo) return;

        document.getElementById('summary-city').textContent = transferInfo.city;
        document.getElementById('summary-duration').textContent = formatDuration(transferInfo.duration);
      }

      // ì‹œê°„ í¬ë§·íŒ…
      function formatDuration(durationMs) {
        const hours = Math.floor(durationMs / (1000 * 60 * 60));
        const minutes = Math.floor((durationMs % (1000 * 60 * 60)) / (1000 * 60));
        
        let result = '';
        if (hours > 0) result += `${hours}ì‹œê°„`;
        if (minutes > 0) result += ` ${minutes}ë¶„`;
        
        return result || '0ë¶„';
      }

      // ê³µí•­ ì„ í˜¸ë„ ì´ˆê¸°í™”
      function initializeAirportPreferences() {
        const cards = document.querySelectorAll('#preferences-step .preference-card');
        cards.forEach(card => {
          card.addEventListener('click', function() {
            togglePreference(this.dataset.category);
          });
        });
      }

      // ê³µí•­ ì„ í˜¸ë„ í† ê¸€
      function togglePreference(category) {
        const card = document.querySelector(`#preferences-step [data-category="${category}"]`);
        
        if (selectedAirportPreferences.includes(category)) {
          selectedAirportPreferences = selectedAirportPreferences.filter(p => p !== category);
          card.classList.remove('selected');
        } else {
          selectedAirportPreferences.push(category);
          card.classList.add('selected');
        }
        
        updateAirportPreferencesNextButton();
      }

      // ê³µí•­ ì„ í˜¸ë„ ë‹¤ìŒ ë²„íŠ¼ ì—…ë°ì´íŠ¸
      function updateAirportPreferencesNextButton() {
        const nextButton = document.getElementById('preferences-next');
        nextButton.disabled = selectedAirportPreferences.length === 0;
      }

      // ê³µí•­ POI ì„ íƒ ë‹¨ê³„ë¡œ ì´ë™
      function nextToAirportPOISelection() {
        if (selectedAirportPreferences.length === 0) return;
        
        currentStep = 'airport-poi-selection';
        document.getElementById('preferences-step').style.display = 'none';
        document.getElementById('airport-poi-step').style.display = 'block';
        
        initializeAirportPOISelection();
      }

      // ê³µí•­ POI ì„ íƒ ì´ˆê¸°í™”
      function initializeAirportPOISelection() {
        generateAirportFilterButtons();
        generateAirportPOICards();
        updateAirportPOINextButton();
      }

      // ê³µí•­ í•„í„° ë²„íŠ¼ ìƒì„±
      function generateAirportFilterButtons() {
        const container = document.getElementById('airport-filter-buttons');
        container.innerHTML = '';
        
        const allButton = document.createElement('button');
        allButton.className = 'filter-btn active';
        allButton.textContent = 'ì „ì²´';
        allButton.onclick = () => filterAirportPOIs('all');
        container.appendChild(allButton);
        
        selectedAirportPreferences.forEach(category => {
          const button = document.createElement('button');
          button.className = 'filter-btn';
          button.textContent = getCategoryLabel(category);
          button.onclick = () => filterAirportPOIs(category);
          container.appendChild(button);
        });
      }

      // ê³µí•­ POI ì¹´ë“œ ìƒì„± (ì„ì‹œ ë°ì´í„°)
      function generateAirportPOICards() {
        const container = document.getElementById('airport-poi-grid');
        container.innerHTML = '';
        
        // ì„ì‹œ ê³µí•­ POI ë°ì´í„°
        const sampleAirportPOIs = [
          { id: 1, name: 'ë©´ì„¸ì  A', category: 'shopping', description: 'ë¸Œëœë“œ ë©´ì„¸ì ', estimatedTime: 60 },
          { id: 2, name: 'ê³µí•­ ì¹´í˜', category: 'food', description: 'ë¡œì»¬ ì»¤í”¼ ì „ë¬¸ì ', estimatedTime: 30 },
          { id: 3, name: 'ë¬¸í™” ì „ì‹œê´€', category: 'culture', description: 'í•œêµ­ ì „í†µ ë¬¸í™” ì²´í—˜', estimatedTime: 45 },
          { id: 4, name: 'ìŠ¤íŒŒ & ë§ˆì‚¬ì§€', category: 'relax', description: 'ê³µí•­ ë‚´ íœ´ì‹ ê³µê°„', estimatedTime: 90 },
          { id: 5, name: 'ê²Œì„ì¡´', category: 'entertainment', description: 'VR ê²Œì„ ì²´í—˜', estimatedTime: 30 },
          { id: 6, name: 'ì€í–‰ ATM', category: 'services', description: 'í™˜ì „ ë° í˜„ê¸ˆ ì¸ì¶œ', estimatedTime: 15 }
        ];
        
        sampleAirportPOIs.forEach(poi => {
          if (selectedAirportPreferences.includes(poi.category) || selectedAirportPreferences.length === 0) {
            const card = createAirportPOICard(poi);
            container.appendChild(card);
          }
        });
      }

      // ê³µí•­ POI ì¹´ë“œ ìƒì„±
      function createAirportPOICard(poi) {
        const card = document.createElement('div');
        card.className = 'poi-card';
        card.dataset.poiId = poi.id;
        card.dataset.category = poi.category;
        
        card.innerHTML = `
          <div class="poi-header">
            <h4>${poi.name}</h4>
            <span class="poi-category">${getCategoryLabel(poi.category)}</span>
          </div>
          <p class="poi-description">${poi.description}</p>
          <div class="poi-footer">
            <span class="estimated-time">ì˜ˆìƒ ì†Œìš”ì‹œê°„: ${poi.estimatedTime}ë¶„</span>
            <button class="btn btn--small" onclick="toggleAirportPOI(${poi.id})">ì„ íƒ</button>
          </div>
        `;
        
        return card;
      }

      // ê³µí•­ POI í† ê¸€
      function toggleAirportPOI(poiId) {
        const card = document.querySelector(`#airport-poi-grid [data-poi-id="${poiId}"]`);
        const button = card.querySelector('button');
        
        if (selectedAirportPOIs.includes(poiId)) {
          selectedAirportPOIs = selectedAirportPOIs.filter(id => id !== poiId);
          card.classList.remove('selected');
          button.textContent = 'ì„ íƒ';
        } else {
          selectedAirportPOIs.push(poiId);
          card.classList.add('selected');
          button.textContent = 'ì„ íƒë¨';
        }
        
        updateAirportSelectedPOIsList();
        updateAirportPOINextButton();
      }

      // ì„ íƒëœ ê³µí•­ POI ëª©ë¡ ì—…ë°ì´íŠ¸
      function updateAirportSelectedPOIsList() {
        const container = document.getElementById('airport-selected-list');
        
        if (selectedAirportPOIs.length === 0) {
          container.innerHTML = '<p class="empty-message">ì•„ì§ ì„ íƒí•œ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
          return;
        }
        
        container.innerHTML = selectedAirportPOIs.map(poiId => {
          const card = document.querySelector(`#airport-poi-grid [data-poi-id="${poiId}"]`);
          const name = card.querySelector('h4').textContent;
          const category = card.querySelector('.poi-category').textContent;
          const time = card.querySelector('.estimated-time').textContent;
          
          return `
            <div class="selected-poi-item">
              <div class="poi-info">
                <h5>${name}</h5>
                <span class="poi-category">${category}</span>
              </div>
              <div class="poi-time">${time}</div>
              <button class="btn btn--small btn--ghost" onclick="toggleAirportPOI(${poiId})">ì œê±°</button>
            </div>
          `;
        }).join('');
      }

      // ê³µí•­ POI ë‹¤ìŒ ë²„íŠ¼ ì—…ë°ì´íŠ¸
      function updateAirportPOINextButton() {
        const nextButton = document.getElementById('airport-poi-next');
        nextButton.disabled = selectedAirportPOIs.length === 0;
      }

      // ê³µí•­ í•„í„° ì ìš©
      function filterAirportPOIs(category) {
        document.querySelectorAll('#airport-filter-buttons .filter-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        document.querySelectorAll('#airport-poi-grid .poi-card').forEach(card => {
          if (category === 'all' || card.dataset.category === category) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
      }

      // ë„ì‹œ ì„ í˜¸ë„ í† ê¸€
      function toggleCityPreference(category) {
        const card = document.querySelector(`#city-preferences-step [data-category="${category}"]`);
        
        if (selectedCityPreferences.includes(category)) {
          selectedCityPreferences = selectedCityPreferences.filter(p => p !== category);
          card.classList.remove('selected');
        } else {
          selectedCityPreferences.push(category);
          card.classList.add('selected');
        }
        
        updateCityPreferencesNextButton();
      }

      // ë„ì‹œ ì„ í˜¸ë„ ë‹¤ìŒ ë²„íŠ¼ ì—…ë°ì´íŠ¸
      function updateCityPreferencesNextButton() {
        const nextButton = document.getElementById('city-preferences-next');
        nextButton.disabled = selectedCityPreferences.length === 0;
      }

      // ë„ì‹œ ì„ í˜¸ë„ ë‹¨ê³„ë¡œ ì´ë™
      function nextToCityPreferences() {
        if (selectedAirportPOIs.length === 0) return;
        
        currentStep = 'city-preferences';
        document.getElementById('airport-poi-step').style.display = 'none';
        document.getElementById('city-preferences-step').style.display = 'block';
      }

      // ë„ì‹œ POI ì„ íƒ ë‹¨ê³„ë¡œ ì´ë™
      function nextToCityPOISelection() {
        if (selectedCityPreferences.length === 0) return;
        
        currentStep = 'city-poi-selection';
        document.getElementById('city-preferences-step').style.display = 'none';
        document.getElementById('city-poi-step').style.display = 'block';
        
        initializeCityPOISelection();
      }

      // ë„ì‹œ POI ì„ íƒ ì´ˆê¸°í™”
      function initializeCityPOISelection() {
        generateCityFilterButtons();
        generateCityPOICards();
        updateCityPOINextButton();
      }

      // ë„ì‹œ í•„í„° ë²„íŠ¼ ìƒì„±
      function generateCityFilterButtons() {
        const container = document.getElementById('city-filter-buttons');
        container.innerHTML = '';
        
        const allButton = document.createElement('button');
        allButton.className = 'filter-btn active';
        allButton.textContent = 'ì „ì²´';
        allButton.onclick = () => filterCityPOIs('all');
        container.appendChild(allButton);
        
        selectedCityPreferences.forEach(category => {
          const button = document.createElement('button');
          button.className = 'filter-btn';
          button.textContent = getCityCategoryLabel(category);
          button.onclick = () => filterCityPOIs(category);
          container.appendChild(button);
        });
      }

      // ë„ì‹œ ì¹´í…Œê³ ë¦¬ ë¼ë²¨ ê°€ì ¸ì˜¤ê¸°
      function getCityCategoryLabel(category) {
        const labels = {
          attractions: 'ê´€ê´‘ëª…ì†Œ',
          shopping: 'ì‡¼í•‘',
          food: 'ìŒì‹',
          culture: 'ë¬¸í™”ì²´í—˜',
          nature: 'ìì—°',
          nightlife: 'ì•¼ê²½/ì•¼ìƒí™œ'
        };
        return labels[category] || category;
      }

      // ë„ì‹œ POI ì¹´ë“œ ìƒì„± (ì„ì‹œ ë°ì´í„°)
      function generateCityPOICards() {
        const container = document.getElementById('city-poi-grid');
        container.innerHTML = '';
        
        // ì„ì‹œ ë„ì‹œ POI ë°ì´í„°
        const sampleCityPOIs = [
          { id: 101, name: 'ë„ì‹œ ëœë“œë§ˆí¬', category: 'attractions', description: 'ìœ ëª…í•œ ê´€ê´‘ëª…ì†Œ', estimatedTime: 120 },
          { id: 102, name: 'ë¡œì»¬ ì‹œì¥', category: 'shopping', description: 'ì „í†µ ì‹œì¥ ì²´í—˜', estimatedTime: 90 },
          { id: 103, name: 'ì „í†µ ë§›ì§‘', category: 'food', description: 'ë¡œì»¬ ì „í†µ ìŒì‹', estimatedTime: 60 },
          { id: 104, name: 'ë°•ë¬¼ê´€', category: 'culture', description: 'ì—­ì‚¬ ë¬¸í™” ì²´í—˜', estimatedTime: 90 },
          { id: 105, name: 'ì¤‘ì•™ ê³µì›', category: 'nature', description: 'ìì—° íœ´ì‹ ê³µê°„', estimatedTime: 60 },
          { id: 106, name: 'ì•¼ê²½ ì „ë§ëŒ€', category: 'nightlife', description: 'ë„ì‹œ ì•¼ê²½ ê°ìƒ', estimatedTime: 45 }
        ];
        
        sampleCityPOIs.forEach(poi => {
          if (selectedCityPreferences.includes(poi.category) || selectedCityPreferences.length === 0) {
            const card = createCityPOICard(poi);
            container.appendChild(card);
          }
        });
      }

      // ë„ì‹œ POI ì¹´ë“œ ìƒì„±
      function createCityPOICard(poi) {
        const card = document.createElement('div');
        card.className = 'poi-card';
        card.dataset.poiId = poi.id;
        card.dataset.category = poi.category;
        
        card.innerHTML = `
          <div class="poi-header">
            <h4>${poi.name}</h4>
            <span class="poi-category">${getCityCategoryLabel(poi.category)}</span>
          </div>
          <p class="poi-description">${poi.description}</p>
          <div class="poi-footer">
            <span class="estimated-time">ì˜ˆìƒ ì†Œìš”ì‹œê°„: ${poi.estimatedTime}ë¶„</span>
            <button class="btn btn--small" onclick="toggleCityPOI(${poi.id})">ì„ íƒ</button>
          </div>
        `;
        
        return card;
      }

      // ë„ì‹œ POI í† ê¸€
      function toggleCityPOI(poiId) {
        const card = document.querySelector(`#city-poi-grid [data-poi-id="${poiId}"]`);
        const button = card.querySelector('button');
        
        if (selectedCityPOIs.includes(poiId)) {
          selectedCityPOIs = selectedCityPOIs.filter(id => id !== poiId);
          card.classList.remove('selected');
          button.textContent = 'ì„ íƒ';
        } else {
          selectedCityPOIs.push(poiId);
          card.classList.add('selected');
          button.textContent = 'ì„ íƒë¨';
        }
        
        updateCitySelectedPOIsList();
        updateCityPOINextButton();
      }

      // ì„ íƒëœ ë„ì‹œ POI ëª©ë¡ ì—…ë°ì´íŠ¸
      function updateCitySelectedPOIsList() {
        const container = document.getElementById('city-selected-list');
        
        if (selectedCityPOIs.length === 0) {
          container.innerHTML = '<p class="empty-message">ì•„ì§ ì„ íƒí•œ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
          return;
        }
        
        container.innerHTML = selectedCityPOIs.map(poiId => {
          const card = document.querySelector(`#city-poi-grid [data-poi-id="${poiId}"]`);
          const name = card.querySelector('h4').textContent;
          const category = card.querySelector('.poi-category').textContent;
          const time = card.querySelector('.estimated-time').textContent;
          
          return `
            <div class="selected-poi-item">
              <div class="poi-info">
                <h5>${name}</h5>
                <span class="poi-category">${category}</span>
              </div>
              <div class="poi-time">${time}</div>
              <button class="btn btn--small btn--ghost" onclick="toggleCityPOI(${poiId})">ì œê±°</button>
            </div>
          `;
        }).join('');
      }

      // ë„ì‹œ POI ë‹¤ìŒ ë²„íŠ¼ ì—…ë°ì´íŠ¸
      function updateCityPOINextButton() {
        const nextButton = document.getElementById('city-poi-next');
        nextButton.disabled = selectedCityPOIs.length === 0;
      }

      // ë„ì‹œ í•„í„° ì ìš©
      function filterCityPOIs(category) {
        document.querySelectorAll('#city-filter-buttons .filter-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        document.querySelectorAll('#city-poi-grid .poi-card').forEach(card => {
          if (category === 'all' || card.dataset.category === category) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
      }

      // ì¼ì • ë‹¨ê³„ë¡œ ì´ë™
      function nextToSchedule() {
        if (selectedCityPOIs.length === 0) return;
        
        currentStep = 'schedule';
        document.getElementById('city-poi-step').style.display = 'none';
        document.getElementById('schedule-step').style.display = 'block';
        
        generateSchedule();
      }

      // ì¼ì • ìƒì„±
      function generateSchedule() {
        generateAirportSchedule();
        generateCitySchedule();
      }

      // ê³µí•­ ë‚´ë¶€ ì¼ì • ìƒì„±
      function generateAirportSchedule() {
        const container = document.getElementById('airport-timeline');
        container.innerHTML = '';
        
        const arrivalTime = new Date(transferInfo.arrival);
        let currentTime = new Date(arrivalTime);
        
        selectedAirportPOIs.forEach((poiId, index) => {
          const card = document.querySelector(`#airport-poi-grid [data-poi-id="${poiId}"]`);
          const name = card.querySelector('h4').textContent;
          const category = card.querySelector('.poi-category').textContent;
          const timeText = card.querySelector('.estimated-time').textContent;
          const estimatedTime = parseInt(timeText.match(/\d+/)[0]);
          
          const timelineItem = document.createElement('div');
          timelineItem.className = 'timeline-item';
          
          const startTime = new Date(currentTime);
          const endTime = new Date(currentTime.getTime() + estimatedTime * 60000);
          
          timelineItem.innerHTML = `
            <div class="timeline-time">
              <span class="start-time">${formatTime(startTime)}</span>
              <span class="end-time">${formatTime(endTime)}</span>
            </div>
            <div class="timeline-content">
              <h4>${name}</h4>
              <span class="timeline-category">${category}</span>
              <p>${estimatedTime}ë¶„ ì²´ë¥˜</p>
            </div>
          `;
          
          container.appendChild(timelineItem);
          currentTime = endTime;
        });
      }

      // ë„ì‹œ ì¼ì • ìƒì„±
      function generateCitySchedule() {
        const container = document.getElementById('city-timeline');
        container.innerHTML = '';
        
        // ë„ì‹œ íƒë°© ì‹œì‘ ì‹œê°„ (ê³µí•­ ë‚´ë¶€ ì¼ì • í›„)
        const cityStartTime = new Date(transferInfo.arrival);
        cityStartTime.setHours(cityStartTime.getHours() + 2); // ê³µí•­ ë‚´ë¶€ 2ì‹œê°„ í›„
        let currentTime = new Date(cityStartTime);
        
        selectedCityPOIs.forEach((poiId, index) => {
          const card = document.querySelector(`#city-poi-grid [data-poi-id="${poiId}"]`);
          const name = card.querySelector('h4').textContent;
          const category = card.querySelector('.poi-category').textContent;
          const timeText = card.querySelector('.estimated-time').textContent;
          const estimatedTime = parseInt(timeText.match(/\d+/)[0]);
          
          const timelineItem = document.createElement('div');
          timelineItem.className = 'timeline-item';
          
          const startTime = new Date(currentTime);
          const endTime = new Date(currentTime.getTime() + estimatedTime * 60000);
          
          timelineItem.innerHTML = `
            <div class="timeline-time">
              <span class="start-time">${formatTime(startTime)}</span>
              <span class="end-time">${formatTime(endTime)}</span>
            </div>
            <div class="timeline-content">
              <h4>${name}</h4>
              <span class="timeline-category">${category}</span>
              <p>${estimatedTime}ë¶„ ì²´ë¥˜</p>
            </div>
          `;
          
          container.appendChild(timelineItem);
          currentTime = endTime;
        });
      }

      // ì‹œê°„ í¬ë§·íŒ…
      function formatTime(date) {
        const hours = String(date.getHours()).padStart(2, '0');
        const minutes = String(date.getMinutes()).padStart(2, '0');
        return `${hours}:${minutes}`;
      }

      // ë„¤ë¹„ê²Œì´ì…˜ ì‹œì‘
      function startNavigation() {
        // ì„ íƒëœ ëª¨ë“  ì •ë³´ë¥¼ ë¼ìš°í„° ìƒíƒœì— ì €ì¥
        const scheduleData = {
          transferInfo,
          airportPreferences: selectedAirportPreferences,
          airportPOIs: selectedAirportPOIs,
          cityPreferences: selectedCityPreferences,
          cityPOIs: selectedCityPOIs,
          type: 'airport-external'
        };
        
        // ë¼ìš°í„°ë¥¼ í†µí•´ ì¼ì • ìš”ì•½ í˜ì´ì§€ë¡œ ì´ë™
        window.navigateTo('/trip-summary', { schedule: scheduleData });
      }

      // ë’¤ë¡œê°€ê¸° í•¨ìˆ˜ë“¤
      function backToAirportPreferences() {
        currentStep = 'preferences';
        document.getElementById('airport-poi-step').style.display = 'none';
        document.getElementById('preferences-step').style.display = 'block';
      }

      function backToAirportPOISelection() {
        currentStep = 'airport-poi-selection';
        document.getElementById('city-preferences-step').style.display = 'none';
        document.getElementById('airport-poi-step').style.display = 'block';
      }

      function backToCityPreferences() {
        currentStep = 'city-preferences';
        document.getElementById('city-poi-step').style.display = 'none';
        document.getElementById('city-preferences-step').style.display = 'block';
      }

      function backToCityPOISelection() {
        currentStep = 'city-poi-selection';
        document.getElementById('schedule-step').style.display = 'none';
        document.getElementById('city-poi-step').style.display = 'block';
      }

      // ì¹´í…Œê³ ë¦¬ ë¼ë²¨ ê°€ì ¸ì˜¤ê¸° (ê³µí•­ìš©)
      function getCategoryLabel(category) {
        const labels = {
          shopping: 'ì‡¼í•‘',
          food: 'ìŒì‹',
          culture: 'ë¬¸í™”ì²´í—˜',
          relax: 'íœ´ì‹',
          entertainment: 'ì—”í„°í…Œì¸ë¨¼íŠ¸',
          services: 'í¸ì˜ì‹œì„¤'
        };
        return labels[category] || category;
      }
    </script>
  </body>
</html>
