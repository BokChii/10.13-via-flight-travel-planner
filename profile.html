<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="supabase-url" content="https://qghwyrdxxlsigtputuyj.supabase.co" />
    <meta name="supabase-anon-key" content="YOUR_SUPABASE_ANON_KEY" />
    <title>í”„ë¡œí•„ - Via Flight</title>
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="stylesheet" href="styles/components/buttons.css" />
    <link rel="stylesheet" href="styles/components/cards.css" />
    <link rel="stylesheet" href="styles/pages/profile.css" />
  </head>
  <body class="app profile-page">
    <header class="app-header">
      <div>
        <h1>Via Flight</h1>
        <p class="tagline">ë‚´ í”„ë¡œí•„</p>
        <nav class="breadcrumb">
          <a href="index.html" class="breadcrumb__link">â† í™ˆìœ¼ë¡œ</a>
        </nav>
      </div>
      
      <!-- ì¸ì¦ UI -->
      <div class="auth-container">
        <div class="user-info-container" style="display: none;" title="í”„ë¡œí•„ ë³´ê¸°">
          <span class="user-info"></span>
          <span class="user-email"></span>
        </div>
        <button class="auth-button" data-action="login" onclick="window.loginWithGoogle()">
          Googleë¡œ ë¡œê·¸ì¸
        </button>
        <button class="auth-button" data-action="logout" style="display: none;" onclick="window.logout()">
          ë¡œê·¸ì•„ì›ƒ
        </button>
      </div>
    </header>

    <main class="profile-main">
      <!-- í”„ë¡œí•„ ì •ë³´ ì„¹ì…˜ -->
      <section class="profile-section">
        <div class="profile-card">
          <h2 class="section-title">ğŸ‘¤ í”„ë¡œí•„ ì •ë³´</h2>
          <div class="profile-info">
            <div class="profile-field">
              <label>ë‹‰ë„¤ì„</label>
              <div class="profile-value">
                <span id="profile-nickname">-</span>
                <button class="btn btn--small btn--ghost" id="edit-nickname-btn" onclick="editNickname()">
                  ìˆ˜ì •
                </button>
              </div>
            </div>
            <div class="profile-field">
              <label>ì´ë©”ì¼</label>
              <div class="profile-value" id="profile-email">-</div>
            </div>
            <div class="profile-field" id="nickname-edit-form" style="display: none;">
              <label>ìƒˆ ë‹‰ë„¤ì„</label>
              <div class="profile-value">
                <input type="text" id="nickname-input" maxlength="20" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
                <button class="btn btn--small btn--primary" onclick="saveNickname()">ì €ì¥</button>
                <button class="btn btn--small btn--ghost" onclick="cancelEditNickname()">ì·¨ì†Œ</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ë‚´ ì¼ì • ì„¹ì…˜ -->
      <section class="profile-section">
        <div class="profile-card">
          <h2 class="section-title">ğŸ“… ë‚´ ì¼ì •</h2>
          <div id="schedules-list" class="schedules-list">
            <p class="empty-message">ì €ì¥ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        </div>
      </section>

      <!-- ì‘ì„±í•œ ë¦¬ë·° ì„¹ì…˜ -->
      <section class="profile-section">
        <div class="profile-card">
          <h2 class="section-title">âœï¸ ì‘ì„±í•œ ë¦¬ë·°</h2>
          <div id="my-reviews-list" class="reviews-list">
            <p class="empty-message">ì‘ì„±í•œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        </div>
      </section>

      <!-- ì¢‹ì•„ìš”í•œ ë¦¬ë·° ì„¹ì…˜ -->
      <section class="profile-section">
        <div class="profile-card">
          <h2 class="section-title">â¤ï¸ ì¢‹ì•„ìš”í•œ ë¦¬ë·°</h2>
          <div id="liked-reviews-list" class="reviews-list">
            <p class="empty-message">ì¢‹ì•„ìš”í•œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        </div>
      </section>
    </main>

    <!-- initProfilePageë¥¼ ë¨¼ì € ì •ì˜ (ë¹„ëª¨ë“ˆ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì¦‰ì‹œ ì‹¤í–‰) -->
    <script>
      // í”„ë¡œí•„ í˜ì´ì§€ ì´ˆê¸°í™” í•¨ìˆ˜ë¥¼ ë¨¼ì € ì •ì˜ (ë¹ˆ í•¨ìˆ˜ë¡œ ì‹œì‘, ë‚˜ì¤‘ì— ì‹¤ì œ êµ¬í˜„ìœ¼ë¡œ êµì²´)
      window.initProfilePage = async function() {
        // ì‹¤ì œ êµ¬í˜„ì€ ì•„ë˜ ëª¨ë“ˆ ìŠ¤í¬ë¦½íŠ¸ì—ì„œ êµì²´ë¨
      };
    </script>

    <script type="module" src="scripts/supabaseClient.js"></script>
    <script type="module" src="scripts/userProfile.js"></script>
    <script type="module" src="scripts/scheduleDB.js"></script>
    <script type="module" src="scripts/auth.js"></script>
    <script src="scripts/reviewDB.js"></script>
    <script type="module">
      import { initAuth } from './scripts/auth.js';
      
      // Auth0 ì´ˆê¸°í™” (ë¹„ë™ê¸°ë¡œ ì™„ë£Œ ëŒ€ê¸°)
      let authInitPromise = null;
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          authInitPromise = initAuth();
        });
      } else {
        authInitPromise = initAuth();
      }
      
      // í”„ë¡œí•„ í˜ì´ì§€ ì´ˆê¸°í™” (router.jsë³´ë‹¤ ë¨¼ì € ì •ì˜, ì‹¤ì œ êµ¬í˜„ìœ¼ë¡œ êµì²´)
      window.initProfilePage = async function() {
        // Auth0 ì´ˆê¸°í™”ê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°
        if (authInitPromise) {
          await authInitPromise;
        } else {
          // ì´ë¯¸ ì´ˆê¸°í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê³  í•„ìš”ì‹œ ì¬ì´ˆê¸°í™”
          if (window.initAuth) {
            await window.initAuth();
          }
        }
        
        // ë¡œê·¸ì¸ í™•ì¸
        if (window.requireAuth) {
          const authenticated = await window.requireAuth('í”„ë¡œí•„ì„ ë³´ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
          if (!authenticated) {
            return;
          }
        }
        
        await loadProfileData();
      };
      
      // í”„ë¡œí•„ ë°ì´í„° ë¡œë“œ
      async function loadProfileData() {
        try {
          const userId = window.getUserId ? await window.getUserId() : null;
          if (!userId) {
            alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }
          
          // í”„ë¡œí•„ ì •ë³´ ë¡œë“œ
          const nickname = await window.getCurrentUserNickname();
          const email = await window.getUserEmail();
          
          document.getElementById('profile-nickname').textContent = nickname || '-';
          document.getElementById('profile-email').textContent = email || '-';
          
          // ë‚´ ì¼ì • ë¡œë“œ
          await loadMySchedules(userId);
          
          // ì‘ì„±í•œ ë¦¬ë·° ë¡œë“œ
          await loadMyReviews(userId);
          
          // ì¢‹ì•„ìš”í•œ ë¦¬ë·° ë¡œë“œ
          await loadLikedReviews(userId);
          
        } catch (error) {
          console.error('í”„ë¡œí•„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        }
      }
      
      // ë‹‰ë„¤ì„ ìˆ˜ì •
      function editNickname() {
        document.getElementById('nickname-edit-form').style.display = 'block';
        const currentNickname = document.getElementById('profile-nickname').textContent;
        document.getElementById('nickname-input').value = currentNickname;
      }
      
      // ë‹‰ë„¤ì„ ìˆ˜ì • ì·¨ì†Œ
      function cancelEditNickname() {
        document.getElementById('nickname-edit-form').style.display = 'none';
        document.getElementById('nickname-input').value = '';
      }
      
      // ë‹‰ë„¤ì„ ì €ì¥
      async function saveNickname() {
        const newNickname = document.getElementById('nickname-input').value.trim();
        if (!newNickname) {
          alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
          return;
        }
        
        if (newNickname.length > 20) {
          alert('ë‹‰ë„¤ì„ì€ 20ì ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.');
          return;
        }
        
        try {
          const userId = window.getUserId ? await window.getUserId() : null;
          if (!userId) {
            alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }
          
          await window.updateUserNickname(userId, newNickname);
          document.getElementById('profile-nickname').textContent = newNickname;
          cancelEditNickname();
          
          // í—¤ë”ì˜ ì‚¬ìš©ì ì •ë³´ë„ ì—…ë°ì´íŠ¸
          if (window.initAuth) {
            const { getCurrentUser } = await import('./scripts/auth.js');
            const user = await getCurrentUser();
            if (user) {
              const { updateAuthUI } = await import('./scripts/auth.js');
              // updateAuthUIëŠ” ë‚´ë¶€ í•¨ìˆ˜ì´ë¯€ë¡œ ì§ì ‘ í˜¸ì¶œ ë¶ˆê°€
              // ëŒ€ì‹  í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ë˜ëŠ” ì´ë²¤íŠ¸ ë°œìƒ
              window.dispatchEvent(new CustomEvent('authStateChanged', { detail: { user } }));
            }
          }
          
          alert('âœ… ë‹‰ë„¤ì„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.');
        } catch (error) {
          console.error('ë‹‰ë„¤ì„ ì €ì¥ ì‹¤íŒ¨:', error);
          alert('ë‹‰ë„¤ì„ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      }
      
      // ë‚´ ì¼ì • ë¡œë“œ
      async function loadMySchedules(userId) {
        try {
          if (!window.getSchedulesByUserId) {
            const container = document.getElementById('schedules-list');
            container.innerHTML = '<p class="empty-message">ì¼ì • ì €ì¥ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
          }

          const schedules = await window.getSchedulesByUserId(userId);
          const container = document.getElementById('schedules-list');
          
          if (schedules.length === 0) {
            container.innerHTML = '<p class="empty-message">ì €ì¥ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
          }

          container.innerHTML = schedules.map(schedule => {
            const scheduleDate = new Date(schedule.createdAt);
            const formattedDate = formatScheduleDate(scheduleDate);
            const city = schedule.scheduleData?.transferInfo?.city || 'ì•Œ ìˆ˜ ì—†ìŒ';
            
            return `
              <div class="schedule-item" data-schedule-id="${escapeHtml(schedule.scheduleId)}">
                <div class="schedule-item-content" onclick="loadSchedule('${schedule.scheduleId}')">
                  <div class="schedule-item-header">
                    <h3 class="schedule-item-name">${escapeHtml(schedule.scheduleName)}</h3>
                    <button class="btn-delete-schedule" onclick="event.stopPropagation(); deleteScheduleConfirm('${schedule.scheduleId}', '${escapeHtml(schedule.scheduleName)}')" title="ì¼ì • ì‚­ì œ">
                      ğŸ—‘ï¸
                    </button>
                  </div>
                  <div class="schedule-item-meta">
                    <span class="schedule-item-city">ğŸ“ ${escapeHtml(city)}</span>
                    <span class="schedule-item-date">ğŸ“… ${formattedDate}</span>
                  </div>
                </div>
              </div>
            `;
          }).join('');

        } catch (error) {
          console.error('ì¼ì • ë¡œë“œ ì‹¤íŒ¨:', error);
          const container = document.getElementById('schedules-list');
          container.innerHTML = '<p class="empty-message">ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
        }
      }

      // ì¼ì • ë‚ ì§œ í¬ë§·íŒ…
      function formatScheduleDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}.${month}.${day}`;
      }

      // ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸°
      window.loadSchedule = async function(scheduleId) {
        try {
          // ë¨¼ì € getScheduleById ì‹œë„
          let schedule = null;
          if (window.getScheduleById) {
            try {
              schedule = await window.getScheduleById(scheduleId);
            } catch (e) {
              console.warn('getScheduleById ì‹¤íŒ¨, ëŒ€ì²´ ë°©ë²• ì‹œë„:', e);
            }
          }
          
          // getScheduleByIdë¡œ ì°¾ì§€ ëª»í•œ ê²½ìš°, getSchedulesByUserIdë¡œ ì „ì²´ ëª©ë¡ì—ì„œ ì°¾ê¸°
          if (!schedule) {
            const userId = window.getUserId ? await window.getUserId() : null;
            if (userId && window.getSchedulesByUserId) {
              const schedules = await window.getSchedulesByUserId(userId);
              schedule = schedules.find(s => s.scheduleId === scheduleId);
            }
          }
          
          if (!schedule) {
            console.error('ì¼ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. scheduleId:', scheduleId);
            alert('ì¼ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }

          // sessionStorageì— ë°ì´í„° ë³µì›
          sessionStorage.setItem('finalTripPlan', JSON.stringify(schedule.finalTripPlan));
          
          // navigation.htmlì´ plannerResultë¥¼ ì°¾ìœ¼ë¯€ë¡œ ë³„ë„ë¡œ ì €ì¥
          if (schedule.finalTripPlan && schedule.finalTripPlan.plannerResult) {
            sessionStorage.setItem('plannerResult', JSON.stringify(schedule.finalTripPlan.plannerResult));
          }
          
          // cityPlanë„ í™•ì¸ (airport-external íƒ€ì…ì¸ ê²½ìš°)
          if (schedule.finalTripPlan && schedule.finalTripPlan.plannerResult) {
            // plannerResultê°€ cityPlan í˜•ì‹ì¸ ê²½ìš° cityPlanìœ¼ë¡œë„ ì €ì¥
            sessionStorage.setItem('cityPlan', JSON.stringify(schedule.finalTripPlan.plannerResult));
          }
          
          // scheduleDataë„ ë³µì› (navigation.htmlì—ì„œ ì‚¬ìš©)
          if (schedule.scheduleData) {
            // airport-external íƒ€ì…ì¸ ê²½ìš° airportPOIDataë„ ë³µì› í•„ìš”
            if (schedule.scheduleData.type === 'airport-external' && schedule.scheduleData.airportPOIs) {
              const airportPOIData = {
                selectedPOIs: schedule.scheduleData.airportPOIs.map(poi => poi.id),
                allPOIs: schedule.scheduleData.airportPOIs
              };
              sessionStorage.setItem('airportPOIData', JSON.stringify(airportPOIData));
            }
          }

          // navigation.htmlë¡œ ì´ë™
          window.location.href = 'navigation.html';
          
        } catch (error) {
          console.error('ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
          alert('ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      };

      // ì¼ì • ì‚­ì œ í™•ì¸
      window.deleteScheduleConfirm = function(scheduleId, scheduleName) {
        if (confirm(`"${scheduleName}" ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`)) {
          deleteSchedule(scheduleId);
        }
      };

      // ì¼ì • ì‚­ì œ
      async function deleteSchedule(scheduleId) {
        try {
          // scheduleDB.jsì˜ deleteSchedule í•¨ìˆ˜ ì‚¬ìš© (ì´ë¦„ ì¶©ëŒ ë°©ì§€)
          const scheduleDBDelete = window.deleteSchedule;
          if (!scheduleDBDelete) {
            alert('ì¼ì • ì‚­ì œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }
          
          // ì‚­ì œ ì‹¤í–‰
          await scheduleDBDelete(scheduleId);
          
          // ì¼ì • ëª©ë¡ ìƒˆë¡œê³ ì¹¨ (ì‚­ì œ ì™„ë£Œ í›„ ì¦‰ì‹œ)
          const userId = window.getUserId ? await window.getUserId() : null;
          if (userId) {
            // ì•½ê°„ì˜ ì§€ì—°ì„ ì¶”ê°€í•˜ì—¬ IndexedDBê°€ ì™„ì „íˆ ì—…ë°ì´íŠ¸ë˜ë„ë¡ í•¨
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            await loadMySchedules(userId);
            
            // ì‚­ì œëœ ì¼ì •ì´ ì—¬ì „íˆ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸í•˜ê³  í•„í„°ë§
            const container = document.getElementById('schedules-list');
            if (container) {
              // data-schedule-id ì†ì„±ì„ ì‚¬ìš©í•˜ì—¬ ì‚­ì œëœ ì¼ì •ì„ ì°¾ì•„ì„œ ì œê±°
              const deletedItem = container.querySelector(`[data-schedule-id="${scheduleId}"]`);
              if (deletedItem) {
                deletedItem.remove();
              }
              
              // ëª¨ë“  ì¼ì •ì´ ì‚­ì œëœ ê²½ìš° ë¹ˆ ë©”ì‹œì§€ í‘œì‹œ
              const remainingItems = container.querySelectorAll('.schedule-item');
              if (remainingItems.length === 0) {
                container.innerHTML = '<p class="empty-message">ì €ì¥ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
              }
            }
          } else {
            // userIdê°€ ì—†ì–´ë„ ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì‹œë„
            const container = document.getElementById('schedules-list');
            if (container) {
              container.innerHTML = '<p class="empty-message">ì €ì¥ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
          }
          
          alert('âœ… ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
          
        } catch (error) {
          console.error('ì¼ì • ì‚­ì œ ì‹¤íŒ¨:', error);
          alert('ì¼ì • ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
      }
      
      // ì‘ì„±í•œ ë¦¬ë·° ë¡œë“œ
      async function loadMyReviews(userId) {
        try {
          if (!window.reviewDB) {
            return;
          }
          
          await window.reviewDB.initialize();
          
          // ì‚¬ìš©ì IDë¡œ ë¦¬ë·° ì¡°íšŒ
          const reviews = window.reviewDB.getReviewsByUserId
            ? await window.reviewDB.getReviewsByUserId(userId)
            : [];
          
          const container = document.getElementById('my-reviews-list');
          if (reviews.length === 0) {
            container.innerHTML = '<p class="empty-message">ì‘ì„±í•œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
          }
          
          container.innerHTML = reviews.map(review => {
            const stars = 'â­'.repeat(review.overall_review_rating || 0);
            const date = new Date(review.submitted_at);
            const formattedDate = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
            
            return `
              <div class="review-item" onclick="viewReviewDetail('${review.id}')">
                <div class="review-item-header">
                  <span class="review-rating">${stars} ${review.overall_review_rating || 0}.0</span>
                  <span class="review-date">${formattedDate}</span>
                </div>
                <div class="review-item-summary">${escapeHtml(review.overall_review_summary || '')}</div>
                <div class="review-item-city">${review.trip_info_city || ''}</div>
              </div>
            `;
          }).join('');
        } catch (error) {
          console.error('ì‘ì„±í•œ ë¦¬ë·° ë¡œë“œ ì‹¤íŒ¨:', error);
        }
      }
      
      // ì¢‹ì•„ìš”í•œ ë¦¬ë·° ë¡œë“œ
      async function loadLikedReviews(userId) {
        try {
          if (!window.reviewDB) {
            return;
          }
          
          await window.reviewDB.initialize();
          
          // ì‚¬ìš©ì IDë¡œ ì¢‹ì•„ìš”í•œ ë¦¬ë·° ì¡°íšŒ
          const likedReviews = window.reviewDB.getLikedReviewsByUserId
            ? await window.reviewDB.getLikedReviewsByUserId(userId)
            : [];
          
          const container = document.getElementById('liked-reviews-list');
          if (likedReviews.length === 0) {
            container.innerHTML = '<p class="empty-message">ì¢‹ì•„ìš”í•œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
          }
          
          container.innerHTML = likedReviews.map(review => {
            const stars = 'â­'.repeat(review.overall_review_rating || 0);
            const date = new Date(review.submitted_at);
            const formattedDate = `${date.getFullYear()}.${String(date.getMonth() + 1).padStart(2, '0')}.${String(date.getDate()).padStart(2, '0')}`;
            
            return `
              <div class="review-item" onclick="viewReviewDetail('${review.id}')">
                <div class="review-item-header">
                  <span class="review-rating">${stars} ${review.overall_review_rating || 0}.0</span>
                  <span class="review-date">${formattedDate}</span>
                </div>
                <div class="review-item-summary">${escapeHtml(review.overall_review_summary || '')}</div>
                <div class="review-item-city">${review.trip_info_city || ''}</div>
              </div>
            `;
          }).join('');
        } catch (error) {
          console.error('ì¢‹ì•„ìš”í•œ ë¦¬ë·° ë¡œë“œ ì‹¤íŒ¨:', error);
        }
      }
      
      // HTML ì´ìŠ¤ì¼€ì´í”„
      function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
      
      // ë¦¬ë·° ìƒì„¸ ë³´ê¸°
      function viewReviewDetail(reviewId) {
        sessionStorage.setItem('selectedReviewId', reviewId);
        window.location.href = `review-detail.html?id=${reviewId}`;
      }
      
      // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
      window.editNickname = editNickname;
      window.cancelEditNickname = cancelEditNickname;
      window.saveNickname = saveNickname;
      window.viewReviewDetail = viewReviewDetail;
    </script>
    
    <!-- router.jsëŠ” initProfilePageê°€ ì •ì˜ëœ í›„ì— ë¡œë“œ -->
    <script type="module" src="scripts/router.js"></script>
  </body>
</html>

