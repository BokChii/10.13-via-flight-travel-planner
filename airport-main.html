<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="google-maps-api-key" content="AIzaSyCGuiWVQgNS8egFImIxqQjA1LFI47TBmw8" />
    <title>μ—¬ν–‰ μ¤νƒ€μΌ μ„ νƒ - Via Flight</title>
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="stylesheet" href="styles/pages/airport-main.css" />
    <link rel="stylesheet" href="styles/components/buttons.css" />
    <link rel="stylesheet" href="styles/components/cards.css" />
    <link rel="stylesheet" href="styles/components/steps.css" />
  </head>
  <body class="app airport-main-page">
    <header class="app-header">
      <h1>Via Flight</h1>
      <p class="tagline">μ–΄λ–¤ μ—¬ν–‰μ„ μ›ν•μ‹λ‚μ”?</p>
      <nav class="breadcrumb">
        <a href="transfer-info.html" class="breadcrumb__link">β† ν™μΉ μ •λ³΄ μμ •</a>
      </nav>
    </header>

    <main class="airport-main-content">
      <!-- Progress Indicator -->
      <div class="progress-container">
        <div class="progress-steps">
          <div class="step completed">
            <div class="step-number">β“</div>
            <div class="step-label">ν™μΉ μ •λ³΄</div>
          </div>
          <div class="step active">
            <div class="step-number">2</div>
            <div class="step-label">μ—¬ν–‰ μ¤νƒ€μΌ</div>
          </div>
          <div class="step">
            <div class="step-number">3</div>
            <div class="step-label">μΌμ • μƒμ„±</div>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: 66%"></div>
        </div>
      </div>

      <!-- Transfer Summary -->
      <section class="transfer-summary">
        <div class="summary-card">
          <h2 class="summary-title" id="summary-title">ν™μΉ μ •λ³΄</h2>
          <div class="summary-content">
            <div class="summary-item">
              <span class="summary-label">κ²½μ  λ„μ‹</span>
              <span class="summary-value" id="summary-city">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">ν™μΉ μ‹κ°„</span>
              <span class="summary-value" id="summary-duration">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">λ„μ°© μ‹κ°„</span>
              <span class="summary-value" id="summary-arrival">-</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">μ¶λ° μ‹κ°„</span>
              <span class="summary-value" id="summary-departure">-</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Choice Section -->
      <section class="choice-section">
        <h2 class="choice-title">μ–΄λ–¤ μ—¬ν–‰μ„ μ›ν•μ‹λ‚μ”?</h2>
        <p class="choice-description">
          ν™μΉ μ‹κ°„ λ™μ• μ–΄λ–»κ² λ³΄λ‚΄κ³  μ‹¶μΌμ‹ μ§€ μ„ νƒν•΄μ£Όμ„Έμ”.<br>
          μ„ νƒμ— λ”°λΌ λ§μ¶¤ν• μΌμ •μ„ λ§λ“¤μ–΄λ“λ¦½λ‹λ‹¤.
        </p>

        <div class="choice-cards">
          <button class="choice-card" onclick="chooseAirportOnly()">
            <div class="choice-icon">βοΈ</div>
            <h3 class="choice-card-title">κ³µν•­μ—λ§ μμ„λμ”</h3>
            <p class="choice-card-description">
              λ©΄μ„Έμ , λΌμ΄μ§€, λ¬Έν™”μ²΄ν— λ“±<br>
              κ³µν•­ λ‚΄λ¶€μ—μ„λ§ μ¦κΈ°λ” μ—¬ν–‰
            </p>
            <div class="choice-features">
              <span class="feature-tag">λ©΄μ„Έμ </span>
              <span class="feature-tag">λΌμ΄μ§€</span>
              <span class="feature-tag">λ¬Έν™”μ²΄ν—</span>
              <span class="feature-tag">μ‹λ‹Ή</span>
            </div>
            <div class="choice-benefits">
              <div class="benefit-item">
                <span class="benefit-icon">β“</span>
                <span>μ…κµ­ μ‹¬μ‚¬ λ¶ν•„μ”</span>
              </div>
              <div class="benefit-item">
                <span class="benefit-icon">β“</span>
                <span>μ§ λ³΄κ΄€μ† μ΄μ© κ°€λ¥</span>
              </div>
              <div class="benefit-item">
                <span class="benefit-icon">β“</span>
                <span>μ•μ „ν•κ³  νΈλ¦¬ν•¨</span>
              </div>
            </div>
          </button>

          <button class="choice-card" onclick="chooseAirportExternal()">
            <div class="choice-icon">π</div>
            <h3 class="choice-card-title">κ³µν•­ λ°–μ—λ„ λ‚κ°λμ”</h3>
            <p class="choice-card-description">
              λ„μ‹ κ΄€κ΄‘ + κ³µν•­ λ‚΄λ¶€<br>
              λ” ν’λ¶€ν• ν™μΉ μ—¬ν–‰ κ²½ν—
            </p>
            <div class="choice-features">
              <span class="feature-tag">λ΅μ»¬ λ§›μ§‘</span>
              <span class="feature-tag">κ΄€κ΄‘μ§€</span>
              <span class="feature-tag">μ‡Όν•‘</span>
              <span class="feature-tag">λ¬Έν™”μ²΄ν—</span>
            </div>
            <div class="choice-benefits">
              <div class="benefit-item">
                <span class="benefit-icon">β“</span>
                <span>λ΅μ»¬ λ¬Έν™” μ²΄ν—</span>
              </div>
              <div class="benefit-item">
                <span class="benefit-icon">β“</span>
                <span>λ‹¤μ–‘ν• ν™λ™</span>
              </div>
              <div class="benefit-item">
                <span class="benefit-icon">β“</span>
                <span>νΉλ³„ν• μ¶”μ–µ</span>
              </div>
            </div>
          </button>
        </div>
      </section>

      <!-- Recommendations Section -->
      <section class="recommendations-section">
        <h3 class="recommendations-title">π’΅ μ¶”μ² μ •λ³΄</h3>
        <div class="recommendations-grid">
          <div class="recommendation-card">
            <h4>κ³µν•­μ—μ„ λ­ν•μ§€?</h4>
            <div class="recommendation-items">
              <div class="recommendation-item">
                <span class="item-icon">π›οΈ</span>
                <span>λ©΄μ„Έμ  μ‡Όν•‘</span>
              </div>
              <div class="recommendation-item">
                <span class="item-icon">π½οΈ</span>
                <span>κ³µν•­ λ§›μ§‘</span>
              </div>
              <div class="recommendation-item">
                <span class="item-icon">π¨</span>
                <span>λ¬Έν™”μ²΄ν—</span>
              </div>
              <div class="recommendation-item">
                <span class="item-icon">π’†</span>
                <span>μ¤ν & λ§μ‚¬μ§€</span>
              </div>
            </div>
          </div>

          <div class="recommendation-card">
            <h4>λ² μ¤νΈ ν™μΉ μ—¬ν–‰ μ½”μ¤</h4>
            <div class="course-list">
              <div class="course-item">
                <div class="course-time">2-3μ‹κ°„</div>
                <div class="course-content">
                  <strong>κ³µν•­ λ‚΄λ¶€ νƒν—</strong>
                  <p>λ©΄μ„Έμ  + μ‹λ‹Ή + λΌμ΄μ§€</p>
                </div>
              </div>
              <div class="course-item">
                <div class="course-time">4-6μ‹κ°„</div>
                <div class="course-content">
                  <strong>λ„μ‹ λ‚λ“¤μ΄</strong>
                  <p>λ…μ† + λ§›μ§‘ + μ‡Όν•‘</p>
                </div>
              </div>
              <div class="course-item">
                <div class="course-time">6μ‹κ°„+</div>
                <div class="course-content">
                  <strong>ν†µν•© μ—¬ν–‰</strong>
                  <p>κ³µν•­ + λ„μ‹ + λ¬Έν™”μ²΄ν—</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script type="module" src="scripts/router.js"></script>
    <script type="module" src="scripts/sqliteClient.js"></script>
    <script>
      // μ „μ—­ μƒνƒ
      let transferInfo = null;
      let selectedChoice = null;

      // ν™λ™ μΉ΄ν…κ³ λ¦¬ λ§¤ν•‘
      const ACTIVITY_CATEGORIES = {
        'shopping': {
          tableName: 'shopping_options_db_frame',
          icon: 'π›οΈ',
          label: 'λ©΄μ„Έμ  μ‡Όν•‘',
          displayOrder: 1
        },
        'food': {
          tableName: 'meal_options_db_frame',
          icon: 'π½οΈ',
          label: 'κ³µν•­ λ§›μ§‘',
          displayOrder: 2
        },
        'culture': {
          tableName: 'airport_events_db_frame',
          icon: 'π¨',
          label: 'λ¬Έν™”μ²΄ν—',
          displayOrder: 3
        },
        'relax': {
          tableName: 'rests_db_frame',
          icon: 'π’†',
          label: 'μ¤ν & λ§μ‚¬μ§€',
          displayOrder: 4
        }
      };

      // νμ΄μ§€ λ΅λ“ μ‹ ν™μΉ μ •λ³΄ ν‘μ‹
      document.addEventListener('DOMContentLoaded', async function() {
        loadTransferInfo();
        updateSummary();
        
        // κ³µν•­ ν™λ™ λ° μ¶”μ² μ½”μ¤ λ΅λ“ (λΉ„λ™κΈ°)
        await loadAirportActivities();
        renderRecommendationCourses();
        
        // μ• λ‹λ©”μ΄μ… ν¨κ³Ό
        setTimeout(() => {
          document.querySelector('.transfer-summary').style.opacity = '1';
          document.querySelector('.transfer-summary').style.transform = 'translateY(0)';
        }, 300);
        
        setTimeout(() => {
          document.querySelector('.choice-section').style.opacity = '1';
          document.querySelector('.choice-section').style.transform = 'translateY(0)';
        }, 600);
        
        setTimeout(() => {
          document.querySelector('.recommendations-section').style.opacity = '1';
          document.querySelector('.recommendations-section').style.transform = 'translateY(0)';
        }, 900);
      });

      // ν™μΉ μ •λ³΄ λ΅λ“
      function loadTransferInfo() {
        const state = window.getAppState();
        if (state.transferInfo) {
          transferInfo = state.transferInfo;
        } else {
          // κΈ°λ³Έκ°’ μ„¤μ •
          transferInfo = {
            city: 'μ„μΈ',
            arrival: new Date(),
            departure: new Date(Date.now() + 4 * 60 * 60 * 1000),
            duration: 4 * 60 * 60 * 1000
          };
        }
      }

      // μ”μ•½ μ •λ³΄ μ—…λ°μ΄νΈ
      function updateSummary() {
        if (!transferInfo) return;

        document.getElementById('summary-city').textContent = transferInfo.city;
        document.getElementById('summary-duration').textContent = formatDuration(transferInfo.duration);
        document.getElementById('summary-arrival').textContent = formatDateTime(transferInfo.arrival);
        document.getElementById('summary-departure').textContent = formatDateTime(transferInfo.departure);
      }

      // μ‹κ°„ ν¬λ§·ν…
      function formatDuration(durationMs) {
        const hours = Math.floor(durationMs / (1000 * 60 * 60));
        const minutes = Math.floor((durationMs % (1000 * 60 * 60)) / (1000 * 60));
        
        let result = '';
        if (hours > 0) result += `${hours}μ‹κ°„`;
        if (minutes > 0) result += ` ${minutes}λ¶„`;
        
        return result || '0λ¶„';
      }

      // λ‚ μ§ μ‹κ°„ ν¬λ§·ν…
      function formatDateTime(date) {
        if (!date) return '-';
        
        const d = new Date(date);
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        const hours = String(d.getHours()).padStart(2, '0');
        const minutes = String(d.getMinutes()).padStart(2, '0');
        
        return `${year}.${month}.${day} ${hours}:${minutes}`;
      }

      // κ³µν•­μ—λ§ μμ„λμ” μ„ νƒ
      function chooseAirportOnly() {
        selectedChoice = 'airport-only';
        
        // μ„ νƒ μƒνƒ ν‘μ‹
        document.querySelectorAll('.choice-card').forEach(card => {
          card.classList.remove('selected');
        });
        event.target.closest('.choice-card').classList.add('selected');
        
        // λΌμ°ν„°λ¥Ό ν†µν•΄ λ‹¤μ νμ΄μ§€λ΅ μ΄λ™
        setTimeout(() => {
          window.navigateTo('/airport-only', { userChoice: selectedChoice });
        }, 500);
      }

      // κ³µν•­ λ°–μ—λ„ λ‚κ°λμ” μ„ νƒ
      function chooseAirportExternal() {
        selectedChoice = 'airport-external';
        
        // μ„ νƒ μƒνƒ ν‘μ‹
        document.querySelectorAll('.choice-card').forEach(card => {
          card.classList.remove('selected');
        });
        event.target.closest('.choice-card').classList.add('selected');
        
        // λΌμ°ν„°λ¥Ό ν†µν•΄ λ‹¤μ νμ΄μ§€λ΅ μ΄λ™
        setTimeout(() => {
          window.navigateTo('/airport-external', { userChoice: selectedChoice });
        }, 500);
      }

      // λ’¤λ΅κ°€κΈ°
      function goBack() {
        window.goBack();
      }
    </script>
  </body>
</html>
